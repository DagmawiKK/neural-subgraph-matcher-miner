<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
    <title>Interactive Graph Visualizer</title>
    <style>
        :root {
            /* Color Palette - Light Theme */
            --bg-primary: #fafafa;
            --bg-secondary: rgba(255, 255, 255, 0.9);
            --border-light: rgba(0, 0, 0, 0.1);
            --text-primary: #374151;
            --text-secondary: #6b7280;
            
            /* Node Colors */
            --node-default: rgba(59, 130, 246, 0.7);
            --node-anchor: rgba(239, 68, 68, 0.8);
            --node-border: rgba(0, 0, 0, 0.3);
            
            /* Edge Colors */
            --edge-default: rgba(107, 114, 128, 0.6);
            --edge-hover: rgba(59, 130, 246, 0.8);
            
            /* UI Elements */
            --card-bg: rgba(255, 255, 255, 0.95);
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --card-border: rgba(0, 0, 0, 0.1);
            
            /* Grid Colors */
            --grid-minor: rgba(0, 0, 0, 0.03);
            --grid-major: rgba(0, 0, 0, 0.08);
            --grid-axis: rgba(59, 130, 246, 0.15);
            --grid-dots: rgba(0, 0, 0, 0.1);
            --grid-center: rgba(59, 130, 246, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-primary);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        /* Full-screen canvas container */
        #canvas-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        #graph-canvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: grab;
            background-color: var(--bg-primary);
            background-image: 
                radial-gradient(circle at 1px 1px, rgba(0,0,0,0.02) 1px, transparent 0);
            background-size: 20px 20px;
        }

        #graph-canvas:active {
            cursor: grabbing;
        }

        /* Grid background overlay - disabled since we draw grid on canvas */
        #grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: none; /* Grid is now drawn on canvas for proper transformation */
        }

        /* Base UI card styling */
        .ui-card {
            position: absolute;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding: 12px;
            color: var(--text-primary);
            font-size: 14px;
        }

        /* Floating UI component positions */
        .top-left {
            top: 20px;
            left: 20px;
        }

        .top-center {
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
        }

        .top-right {
            top: 20px;
            right: 20px;
        }

        .bottom-right-upper {
            bottom: 180px;
            right: 20px;
        }

        .bottom-right-lower {
            bottom: 20px;
            right: 20px;
        }

        /* Title bar styling */
        #title-bar {
            text-align: center;
            font-weight: 600;
            font-size: 16px;
            min-width: 300px;
        }

        #title-bar .subtitle {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Zoom controls styling */
        #zoom-controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
        }

        #zoom-controls button {
            width: 36px;
            height: 36px;
            border: 1px solid var(--border-light);
            border-radius: 6px;
            background: white;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        #zoom-controls button:hover {
            background: var(--bg-primary);
            border-color: var(--text-secondary);
        }

        #zoom-controls button:active {
            transform: scale(0.95);
        }

        /* Legend card styling */
        #legend-card {
            min-width: 220px;
            max-width: 280px;
            max-height: 400px;
            overflow-y: auto;
        }

        #legend-card h3 {
            margin-bottom: 16px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-light);
            padding-bottom: 8px;
        }

        .legend-section {
            margin-bottom: 16px;
        }

        .legend-section:last-child {
            margin-bottom: 0;
        }

        .legend-section h4 {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 6px;
            font-size: 12px;
            padding: 2px 0;
        }

        .legend-item:last-child {
            margin-bottom: 0;
        }

        .legend-color {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            border: 1px solid var(--border-light);
            flex-shrink: 0;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .legend-shape {
            width: 18px;
            height: 18px;
            border: 1px solid var(--border-light);
            flex-shrink: 0;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .legend-item span {
            color: var(--text-primary);
            font-weight: 500;
            line-height: 1.2;
        }

        /* Controls card styling */
        #controls-card {
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-width: 200px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .control-group label {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--node-default);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        .export-buttons {
            display: flex;
            gap: 8px;
        }

        .export-buttons button {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid var(--border-light);
            border-radius: 4px;
            background: white;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .export-buttons button:hover {
            background: var(--bg-primary);
            border-color: var(--text-secondary);
        }

        /* Context menu styling */
        #context-menu {
            position: absolute;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 6px;
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(10px);
            z-index: 2000;
            padding: 4px 0;
            min-width: 120px;
        }

        #context-menu.hidden {
            display: none;
        }

        .context-menu-item {
            padding: 8px 16px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-primary);
            transition: background-color 0.2s ease;
        }

        .context-menu-item:hover {
            background-color: var(--bg-primary);
        }

        /* Isolation effects */
        .node-isolated {
            filter: blur(2px);
            opacity: 0.3;
        }

        .edge-isolated {
            filter: blur(2px);
            opacity: 0.2;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .ui-card {
                padding: 8px;
                font-size: 12px;
            }
            
            .top-left, .top-right {
                top: 10px;
            }
            
            .top-left {
                left: 10px;
            }
            
            .top-right {
                right: 10px;
            }
            
            .bottom-right-upper {
                bottom: 140px;
                right: 10px;
            }
            
            .bottom-right-lower {
                bottom: 10px;
                right: 10px;
            }
            
            #title-bar {
                min-width: 200px;
                font-size: 14px;
            }
            
            #zoom-controls button {
                width: 32px;
                height: 32px;
                font-size: 16px;
            }
            
            #legend-card, #controls-card {
                min-width: 160px;
            }
        }

        @media (max-width: 480px) {
            .ui-card {
                padding: 6px;
                font-size: 11px;
            }
            
            #title-bar {
                min-width: 150px;
                font-size: 12px;
            }
            
            #zoom-controls button {
                width: 28px;
                height: 28px;
                font-size: 14px;
            }
            
            #legend-card, #controls-card {
                min-width: 140px;
            }
        }
    </style>
</head>
<body>
    <!-- Full-screen canvas container -->
    <div id="canvas-container">
        <canvas id="graph-canvas"></canvas>
        <div id="grid-overlay"></div>
    </div>
    
    <!-- Floating UI Components -->
    
    <!-- Title bar at center-top -->
    <div id="title-bar" class="ui-card top-center">
        <div id="graph-title">Graph Visualization</div>
        <div class="subtitle" id="graph-stats">Loading...</div>
    </div>
    
    <!-- Zoom controls in top-right corner -->
    <div id="zoom-controls" class="ui-card top-right">
        <button id="zoom-in" title="Zoom In">+</button>
        <button id="zoom-out" title="Zoom Out">−</button>
        <button id="recenter" title="Recenter">⌂</button>
    </div>
    
    <!-- Legend card in bottom-right area (upper) -->
    <div id="legend-card" class="ui-card bottom-right-upper">
        <h3>Legend</h3>
        <div id="legend-content">
            <!-- Legend items will be populated by JavaScript -->
        </div>
    </div>
    
    <!-- Controls card in bottom-right area (lower) -->
    <div id="controls-card" class="ui-card bottom-right-lower">
        <div class="control-group">
            <label>Show Labels</label>
            <label class="toggle-switch">
                <input type="checkbox" id="label-toggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <div class="control-group">
            <label>Export</label>
            <div class="export-buttons">
                <button id="export-pdf">PDF</button>
                <button id="export-svg">PNG</button>
            </div>
        </div>
    </div>
    
    <!-- Context Menu -->
    <div id="context-menu" class="hidden">
        <div class="context-menu-item" id="isolate-node">Isolate</div>
        <div class="context-menu-item" id="copy-label">Copy Label</div>
        <div class="context-menu-item" id="cancel-isolate" style="display: none;">Cancel Isolate</div>
    </div>

    <script>
        // Sample 7-node directed graph data
        const GRAPH_DATA = {
        "metadata": {
                "title": "Directed Graph with Anchors",
                "nodeCount": 11,
                "edgeCount": 10,
                "isDirected": true,
                "density": 0.091
        },
        "nodes": [
                {
                        "id": "enst00000316891",
                        "label": "transcript",
                        "transcript_name": "TRIT1-201",
                        "gene_name": "TRIT1",
                        "anchor": false,
                        "x": 27.65196752359671,
                        "y": 197.0768524739416
                },
                {
                        "id": "enst00000441669",
                        "label": "transcript",
                        "transcript_name": "TRIT1-203",
                        "gene_name": "TRIT1",
                        "anchor": false,
                        "x": 198.15733023744193,
                        "y": 37.6455322302267
                },
                {
                        "id": "q9h3h1-1",
                        "label": "protein",
                        "protein_name": "MOD5",
                        "isoform_name": "1",
                        "anchor": false,
                        "x": -95.0809692854939,
                        "y": -177.28703171738803
                },
                {
                        "id": "enst00000372818",
                        "label": "transcript",
                        "transcript_name": "TRIT1-202",
                        "gene_name": "TRIT1",
                        "anchor": false,
                        "x": -166.60054744627251,
                        "y": 98.79798083873025
                },
                {
                        "id": "enst00000491865",
                        "label": "transcript",
                        "transcript_name": "TRIT1-211",
                        "gene_name": "TRIT1",
                        "anchor": false,
                        "x": 134.0590518547878,
                        "y": 137.61826291770697
                },
                {
                        "id": "q9h3h1-4",
                        "label": "protein",
                        "protein_name": "MOD5",
                        "isoform_name": "4",
                        "anchor": false,
                        "x": -93.3767504466559,
                        "y": 183.95972216092807
                },
                {
                        "id": "q9h3h1-5",
                        "label": "protein",
                        "protein_name": "MOD5",
                        "isoform_name": "5",
                        "anchor": false,
                        "x": 200.0,
                        "y": -83.77624813100846
                },
                {
                        "id": "enst00000465417",
                        "label": "transcript",
                        "transcript_name": "TRIT1-206",
                        "gene_name": "TRIT1",
                        "anchor": false,
                        "x": -151.2725718127031,
                        "y": -93.40322484041486
                },
                {
                        "id": "enst00000467774",
                        "label": "transcript",
                        "transcript_name": "TRIT1-207",
                        "gene_name": "TRIT1",
                        "anchor": false,
                        "x": -166.33749633917537,
                        "y": 4.219155404037533
                },
                {
                        "id": "enst00000462243",
                        "label": "transcript",
                        "transcript_name": "TRIT1-204",
                        "gene_name": "TRIT1",
                        "anchor": false,
                        "x": 18.033079069290444,
                        "y": -188.57476352637613
                },
                {
                        "id": "ensg00000043514",
                        "label": "gene",
                        "gene_name": "TRIT1",
                        "anchor": true,
                        "x": 94.7669066451839,
                        "y": -116.27623781038359
                }
        ],
        "edges": [
                {
                        "label": "translates_to",
                        "weight": 1.0,
                        "source": "enst00000316891",
                        "target": "q9h3h1-1",
                        "directed": true,
                        "direction": "enst00000316891 -> q9h3h1-1",
                },
                {
                        "label": "translates_to",
                        "weight": 1.0,
                        "source": "enst00000441669",
                        "target": "q9h3h1-5",
                        "directed": true,
                        "direction": "enst00000441669 -> q9h3h1-5",
                },
                {
                        "label": "translates_to",
                        "weight": 1.0,
                        "source": "enst00000372818",
                        "target": "q9h3h1-4",
                        "directed": true,
                        "direction": "enst00000372818 -> q9h3h1-4",
                },
                {
                        "label": "transcribed_to",
                        "weight": 1.0,
                        "source": "ensg00000043514",
                        "target": "enst00000316891",
                        "directed": true,
                        "direction": "ensg00000043514 -> enst00000316891",
                },
                {
                        "label": "transcribed_to",
                        "weight": 1.0,
                        "source": "ensg00000043514",
                        "target": "enst00000441669",
                        "directed": true,
                        "direction": "ensg00000043514 -> enst00000441669",
                },
                {
                        "label": "transcribed_to",
                        "weight": 1.0,
                        "source": "ensg00000043514",
                        "target": "enst00000372818",
                        "directed": true,
                        "direction": "ensg00000043514 -> enst00000372818",
                },
                {
                        "label": "transcribed_to",
                        "weight": 1.0,
                        "source": "ensg00000043514",
                        "target": "enst00000491865",
                        "directed": true,
                        "direction": "ensg00000043514 -> enst00000491865",
                },
                {
                        "label": "transcribed_to",
                        "weight": 1.0,
                        "source": "ensg00000043514",
                        "target": "enst00000465417",
                        "directed": true,
                        "direction": "ensg00000043514 -> enst00000465417",
                },
                {
                        "label": "transcribed_to",
                        "weight": 1.0,
                        "source": "ensg00000043514",
                        "target": "enst00000467774",
                        "directed": true,
                        "direction": "ensg00000043514 -> enst00000467774",
                },
                {
                        "label": "transcribed_to",
                        "weight": 1.0,
                        "source": "ensg00000043514",
                        "target": "enst00000462243",
                        "directed": true,
                        "direction": "ensg00000043514 -> enst00000462243",
                }
        ],
        "legend": {
                "nodeTypes": [
                        {
                                "label": "gene",
                                "color": "rgba(59, 130, 246, 0.7)",
                                "description": "gene"
                        },
                        {
                                "label": "transcript",
                                "color": "rgba(34, 197, 94, 0.7)",
                                "description": "transcript"
                        },
                        {
                                "label": "protein",
                                "color": "rgba(245, 101, 101, 0.7)",
                                "description": "Protein"
                        }
                ],
                "edgeTypes": [
                        {
                                "label": "transcribed_to",
                                "color": "rgba(34, 100, 94, 0.7)",
                                "description": "transcribed_to"
                        },
                        {
                                "label": "translates_to",
                                "color": "rgba(245, 190, 101, 0.7)",
                                "description": "translates_to"
                        }
                    ]
                }
            };